<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="The Attack Titan" /><meta name="author" content="Ibrahim" /><meta property="og:locale" content="en" /><meta name="description" content="Embark on a daring mission with the Scouts to unravel the mysteries of a merciless world in this Attack on Titan-inspired CTF challenge!" /><meta property="og:description" content="Embark on a daring mission with the Scouts to unravel the mysteries of a merciless world in this Attack on Titan-inspired CTF challenge!" /><link rel="canonical" href="/projects/attack-titan/" /><meta property="og:url" content="/projects/attack-titan/" /><meta property="og:site_name" content="Ibrahim EO." /><meta property="og:image" content="/assets/img/the-attack-titan/aot.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-07-10T00:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="/assets/img/the-attack-titan/aot.webp" /><meta property="twitter:title" content="The Attack Titan" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Ibrahim" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ibrahim"},"dateModified":"2024-08-07T23:03:18+02:00","datePublished":"2024-07-10T00:00:00+02:00","description":"Embark on a daring mission with the Scouts to unravel the mysteries of a merciless world in this Attack on Titan-inspired CTF challenge!","headline":"The Attack Titan","image":"/assets/img/the-attack-titan/aot.webp","mainEntityOfPage":{"@type":"WebPage","@id":"/projects/attack-titan/"},"url":"/projects/attack-titan/"}</script><title>The Attack Titan | Ibrahim EO.</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ibrahim EO."><meta name="application-name" content="Ibrahim EO."><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/elomarii-portfolio.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.27.20/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/avatar.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/whoami">Ibrahim EO.</a></h1><p class="site-subtitle fst-italic mb-0">InfoSec Enthousiaste</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-bars-progress"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/blog/" class="nav-link"> <i class="fa-fw fas fa-newspaper"></i> <span>BLOG</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/whoami/" class="nav-link"> <i class="fa-fw fas fa-chess-rook"></i> <span>WHOAMI</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/elomarii" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/ibrahim-el-omari/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['i.ibrahim.elomari','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>The Attack Titan</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>The Attack Titan</h1><p class="post-desc fw-light mb-4">Embark on a daring mission with the Scouts to unravel the mysteries of a merciless world in this Attack on Titan-inspired CTF challenge!</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1720562400" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 10, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/img/the-attack-titan/aot.webp" class="popup img-link preview-img shimmer"><img src="/assets/img/the-attack-titan/aot.webp" alt="Preview Image" width="1200" height="630" loading="lazy"></a></div><div class="d-flex justify-content-between"> <span> By <em> Ibrahim </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1887 words" > <em>10 min</em> read</span></div></div></div></header><div class="content"><p>In this project, we’ll be creating a CTF box inspired by the world of “The Attack Titan”. Obviously, the content may contain spoilers from the show. In a moment, we’ll delve into web application pentesting and privilege escalation techniques. Each section will outline the specific skills and knowledge we’re targeting.</p><blockquote class="prompt-info"><p>This box is designed to remain beginner-friendly.</p></blockquote><blockquote class="prompt-warning"><p>If you want to give this CTF a try before reading this, you can clone SNK<sup id="fnref:snk" role="doc-noteref"><a href="#fn:snk" class="footnote" rel="footnote">1</a></sup> repository from GitHub to your virtual machine, then run <code class="language-plaintext filepath highlighter-rouge">machine/setup.sh</code> script. Happy hacking!</p></blockquote><h2 id="a-the-web-app"><span class="me-2">A. The web app</span><a href="#a-the-web-app" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p class="browserize" url="http://paradis.snk/"><a href="/assets/img/the-attack-titan/homepage.png" class="popup img-link shimmer"><img src="/assets/img/the-attack-titan/homepage.png" alt="main" loading="lazy"></a></p><p>The web app is designed to be the initial point of assessment for players. The objective of hacking the web app is to obtain the credentials of a user on the machine. Achieving this will allow players to practice the following skills:</p><ol><li>Basic enumeration and source code inspection<li>Hash cracking<li>SQL injection<li>Local File Inclusion / source code disclosure</ol><h3 id="exploration"><span class="me-2">Exploration</span><a href="#exploration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Players typically begin by exploring the web app manually or by fuzzing for hidden content, which is exactly what we anticipate. The <code class="language-plaintext filepath highlighter-rouge">/robots.txt</code> file usually contains information about content that should not be indexed, and it can sometimes reveal interesting details.</p><p>In our case, the <code class="language-plaintext filepath highlighter-rouge">/robots.txt</code> file only contains a hint pointing to the <code class="language-plaintext filepath highlighter-rouge">/titans.txt</code> file. The <code class="language-plaintext filepath highlighter-rouge">/titans.txt</code> file provides some facts about titans and includes a clue leading to a directory called <code class="language-plaintext filepath highlighter-rouge">/shiganshina</code>.. and.. it all started from Shiganshina.</p><div file="robots.txt" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="robots.txt"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre># No robots.. only titans
</pre></table></code></div></div><div file="titans.txt" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="titans.txt"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre># ...
# walls of /shiganshina are destroyed by a colossal titan that appears out of thin air. As the smaller titans flood
# ...
</pre></table></code></div></div><p>Navigating to <code class="language-plaintext filepath highlighter-rouge">/shiganshina</code>, players will find three portals representing the three military groups, each maintained by its respective faction. After exploring and inspecting the source code of these pages, they will uncover a path to a hidden file located at <code class="language-plaintext filepath highlighter-rouge">/0ff1c3rs_leak.zip</code>. According to the comments, this zip file contains credentials from a recent police breach. Players will need to leverage the fact that some passwords may not have been changed yet. However, the zip file is password-protected and must be brute-forced using tools like John the Ripper and the <code class="language-plaintext filepath highlighter-rouge">rockyou.txt</code> wordlist. Spoiler: The password is “Titans curse”.</p><p>As seen in season 3, the military police are closely monitoring the scouts’ progress in their quest to understand and combat the titans. Once players gain access to a police member’s account, they can exploit two vulnerabilities in the app to access a hidden database table containing information about the scouts. The ultimate goal is to obtain Armin’s SSH credentials.</p><h3 id="local-file-inclusion"><span class="me-2">Local File Inclusion</span><a href="#local-file-inclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p class="browserize" url="http://paradis.snk/shiganshina/police/index.php?page=profile"><a href="/assets/img/the-attack-titan/police-profile.png" class="popup img-link shimmer"><img src="/assets/img/the-attack-titan/police-profile.png" alt="police-profile-page" loading="lazy"></a></p><p>The valid credentials for accessing the system belong to Hitch. Players might notice that the URL for the home page includes a page query parameter. This observation should prompt them to test for a file inclusion vulnerability.</p><p>In this scenario, the attacker can exploit a PHP filter to read the source code of <code class="language-plaintext filepath highlighter-rouge">shiganshina/police/index.php</code>. This file will reveal the presence of another file on the server, <code class="language-plaintext filepath highlighter-rouge">db_connection.php</code>, which is used to establish a connection to the database server. Due to poor development practices, the database credentials are hardcoded into this PHP file.</p><p>With these credentials, the attacker can connect to the database and access all hosted data, including Armin’s SSH credentials.</p><h3 id="sql-injection"><span class="me-2">SQL Injection</span><a href="#sql-injection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p class="browserize" url="http://paradis.snk/shiganshina/police/members"><a href="/assets/img/the-attack-titan/police-members.png" class="popup img-link shimmer"><img src="/assets/img/the-attack-titan/police-members.png" alt="police-members" loading="lazy"></a></p><p>If the previous vulnerability went unnoticed, there is an additional one on the members page. The search field is vulnerable to SQL injection, which can be detected by appending a single quote <code class="language-plaintext highlighter-rouge">'</code> to the end of the query. This particular SQL injection is boolean-based, meaning a custom error message is displayed if the query is invalid.</p><p>Once the vulnerability is identified, the attacker can use it to enumerate the database’s tables. By exploring the database, they will eventually find Armin’s credentials.</p><h3 id="a-foot-hold-into-the-machine"><span class="me-2">A foot hold into the machine</span><a href="#a-foot-hold-into-the-machine" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Here we go, the player now have access to Armin’s credentials, but the password is hashed and should be cracked first. The process includes the identification of the hash and the choice of a suitable wordlist to launch the attack.</p><ol><li>Many tools can be used to identify the hash algorithm, e.g. <code class="language-plaintext highlighter-rouge">hashid</code>.<li>The password, once again, is present in the rockyou wordlist.</ol><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>a.arlert:a858ac15923bcf64ce5b50d3d3c341385c51e4e0fc58f0579db2a1d9f77237bd5e1136f8a12241403f04857127ddd76b3535fb7d381ab32fe4e118d5149fad3e
</pre></table></code></div></div><blockquote class="prompt-tip"><p>Crack common passwords’ hashes online with Crackstation<sup id="fnref:crackstation" role="doc-noteref"><a href="#fn:crackstation" class="footnote" rel="footnote">2</a></sup></p></blockquote><h2 id="b-privilege-escalation"><span class="me-2">B. Privilege Escalation</span><a href="#b-privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In this section, the player will practice escalation techniques related to:</p><ol><li>SUID binary with PATH manipulation<li>Misconfigured Network File Share</ol><h3 id="overview"><span class="me-2">Overview</span><a href="#overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The machine hosts accounts for several members of the Survey Corps, including Armin’s, Hanji’s, and Erwin’s. The other accounts are intended to serve as distractions. Therefore, the ultimate goal of this section is to gain access to Erwin’s account.</p><p>The relevant part of the filesystem hierarchy will be as follows:</p><pre><code class="language-txt">/home/
  |__ a.arlert                  # foothold
  |__ m.zacharias               # distraction
  |__ h.zoe
  |     |__ titans        	    # SUID binary 
  |     |__ scouts_share		# NFS
  |__ e.smith
      |__ plan.txt              # target
      |__ plan.jpg
</code></pre><p>Regarding permissions:</p><ul><li><p><strong>Home Folders</strong>: By default, users will not have access to other users’ home folders. The exception is Hanji’s home directory, which is accessible to everyone. This allows users to specifically access the <code class="language-plaintext filepath highlighter-rouge">titans</code> binary.</p><li><p><strong>Scouts Share Directory</strong>: The directory <code class="language-plaintext filepath highlighter-rouge">/home/h.zoe/scouts_share</code> will be restricted and accessible only to Hanji, the owner.</p></ul><h3 id="from-armin-to-hanji"><span class="me-2">From Armin To Hanji</span><a href="#from-armin-to-hanji" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Hanji’s home directory contains a SUID binary named <code class="language-plaintext filepath highlighter-rouge">titans</code>. Normally, this binary is used to access information about all titans. However, the <code class="language-plaintext filepath highlighter-rouge">titans</code> binary makes a call to another binary called <code class="language-plaintext filepath highlighter-rouge">titan</code>, which does not exist on the system.</p><p>Here is the decompiled <code class="language-plaintext filepath highlighter-rouge">titans</code> binary:</p><div file="titans.c" class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="titans.c"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">setuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">setgid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"SC :: Titans database</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    
    <span class="kt">char</span> <span class="o">*</span><span class="n">titans</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"eren"</span><span class="p">,</span> <span class="s">"armored"</span><span class="p">,</span> <span class="s">"colossal"</span><span class="p">};</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"retreiving information of %s ... </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">titans</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
        <span class="n">snprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span> <span class="s">"titan %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">titans</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="n">system</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Once the attacker observes that the titans binary calls a non-existent titan binary, the next step is to create a program with the same name, titan, and place it in a writable directory listed in the PATH variable, or add a new writable directory to the PATH.</p><p>For instance, here’s an example of how the attacker can escalate to Hanji’s privileges:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">PATH</span><span class="o">=</span><span class="s2">"/home/a.arlert/:</span><span class="nv">$PATH</span><span class="s2">"</span>
<span class="nb">cp</span> /bin/bash /home/a.arlert/titan
/home/h.zoe/titans  <span class="c"># -&gt; h.zoe@paradis:~$</span>
</pre></table></code></div></div><h3 id="from-hanji-to-erwin"><span class="me-2">From Hanji To Erwin</span><a href="#from-hanji-to-erwin" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Escalating from Hanji’s account to Erwin’s account, or even to the root account, can be achieved by exploiting the NFS share in Hanji’s home directory. This NFS share is configured with the <code class="language-plaintext highlighter-rouge">no_root_squash</code> option. Thus, by mounting the NFS share on their local machine, an attacker can place a SUID binary —owned by root— onto the share. When this binary is executed, it runs with root privileges, granting the attacker elevated access.</p><blockquote class="prompt-info"><p>The no_root_squash option in NFS is used to control how root access is handled on the client side. When no_root_squash is enabled, the root user on the client machine retains root privileges on the NFS server. This means that the root user can read, write, and modify files on the NFS share as the root user</p></blockquote><h2 id="c-aws-deployment-automation"><span class="me-2">C. AWS Deployment Automation</span><a href="#c-aws-deployment-automation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To automate the creation of an EC2 instance along with all necessary configurations such as users, services, and more, we can use AWS CloudFormation<sup id="fnref:aws-cf" role="doc-noteref"><a href="#fn:aws-cf" class="footnote" rel="footnote">3</a></sup>.</p><blockquote class="prompt-info"><p>Amazon Elastic Compute Cloud (EC2) is a part of Amazon.com’s cloud-computing platform, Amazon Web Services (AWS), that allows users to rent virtual computers on which to run their own computer applications.</p></blockquote><blockquote class="prompt-info"><p>AWS CloudFormation is a service provided by Amazon Web Services (AWS) that enables users to model and manage infrastructure resources in an automated and secure manner. Using CloudFormation, developers can define and provision AWS infrastructure resources using a JSON- or YAML- formatted infrastructure as code template.</p></blockquote><p>The GitHub repository <strong>SNK</strong><sup id="fnref:snk:1" role="doc-noteref"><a href="#fn:snk" class="footnote" rel="footnote">1</a></sup> contains the essential files for setting up and configuring the machine for this CTF environment.</p><p>Configuration steps are consolidated in the <code class="language-plaintext filepath highlighter-rouge">/machine/setup.sh</code> script, which automates the environment setup. Additionally, the <code class="language-plaintext filepath highlighter-rouge">/aws-cloudformation.yaml</code> file provides the CloudFormation specification for defining and deploying the necessary AWS infrastructure.</p><h3 id="setup"><span class="me-2">Setup</span><a href="#setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The setup script is quite straightforward and follows these steps to ensure everything is configured correctly:</p><ol><li>Create the users<li>Populate the home repositories with the content from SNK<li>Setup passwords<li>Configure permissions<ul><li>All folders are accessible only to the respective owner<li>Hanji’s folder is accessible to everyone<li>Hanji’s NFS folder is only accessible to her<li>Assignment of SUID bit to <code class="language-plaintext filepath highlighter-rouge">/home/h.zoe/titans</code></ul><li>Allow SSH connection with password for Armin<li>Setup and enable NFS with <code class="language-plaintext highlighter-rouge">no_root_squash</code><li>Install docker and start the web services</ol><h3 id="cloudformation-spec"><span class="me-2">CloudFormation spec</span><a href="#cloudformation-spec" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As mentioned earlier, the CloudFormation specification file is used to describe the EC2 instance specifications that will be spawned. It also includes instructions to execute the setup script, which configures users, permissions, and services according to the CTF environment described in the previous sections.</p><p>The file begins with the “Parameters” section, which allows us to define parameters that can be used throughout the template. This section also makes it possible to specify or modify these parameters during the creation of a CloudFormation stack, providing flexibility in customizing the instance configuration.</p><blockquote class="prompt-info"><p>A stack is a collection of AWS resources that you can manage as a single unit. In other words, you can create, update, or delete a collection of resources by creating, updating, or deleting stacks.</p></blockquote><p>For instance, we declare the SSH key pair for root access, the Github repo from which to pull resources, and the type of EC2 instance to create.</p><p>In the “Resources” section, we define the resources to be created for our stack. This includes specifying the EC2 instance (referred to as SNK) that will host the CTF environment, along with a security group to permit SSH and HTTP connections. Additionally, we outline several bash commands to execute after the instance starts, which will clone the SNK repository and run the setup script.</p><p>Finally, the “Outputs” section is used to define data to be exported to the CloudFormation dashboard. For our setup, we export the public IP address and EC2 instance ID of the created machine.</p><p>Once the configuration is complete, you can proceed to the AWS Management Console and search for CloudFormation to deploy the stack.</p><p><a href="/assets/img/the-attack-titan/cloudformation-search.png" class="popup img-link shimmer"><img src="/assets/img/the-attack-titan/cloudformation-search.png" alt="searching cloudformation" loading="lazy"></a> <em>searching for CloudFormation in AWS console</em></p><p>In the CloudFormation dashboard, we create a new stack and upload our spec file</p><p><a href="/assets/img/the-attack-titan/cloudformation-home.png" class="popup img-link shimmer"><img src="/assets/img/the-attack-titan/cloudformation-home.png" alt="create stack" loading="lazy"></a> <em>create stack from CloudFormation dashboard</em></p><p><a href="/assets/img/the-attack-titan/step1.png" class="popup img-link shimmer"><img src="/assets/img/the-attack-titan/step1.png" alt="step 1" loading="lazy"></a> <em>preparing the template</em></p><p>Here, we can see that our parameters have been detected, giving us the option to either edit them as needed or proceed with the default values.</p><p><a href="/assets/img/the-attack-titan/step2.png" class="popup img-link shimmer"><img src="/assets/img/the-attack-titan/step2.png" alt="step 2" loading="lazy"></a> <em>edit the parameters if necessary</em></p><p>We can skip the next configurations, as they are not immediately relevant. Once the stack is created, it will take a few seconds to allocate the resources. Eventually, the machine will be ready, and we can access it using the IP address provided in the Outputs tab.</p><p><a href="/assets/img/the-attack-titan/stack-created.png" class="popup img-link shimmer"><img src="/assets/img/the-attack-titan/stack-created.png" alt="stack created" loading="lazy"></a> <em>resources up and running</em></p><h2 id="last-word"><span class="me-2">Last word</span><a href="#last-word" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In conclusion, this project demonstrates the creation and configuration of a CTF environment inspired by the “The Attack Titan” TV show. From web application assessment to privilege escalation, this project offered me an opportunity to learn and revisit many concepts, and it provides you with a chance to practice your skills and have some fun.</p><p>In the next project, we’ll build upon this setup and implement a SIEM system to monitor and analyze user behavior when interacting with the machine.</p><p>Till then… Shinzou wo sasageyo!</p><h2 id="external-links"><span class="me-2">External Links</span><a href="#external-links" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="footnotes" role="doc-endnotes"><ol><li id="fn:snk" role="doc-endnote"><p><a href="https://github.com/elomarii/snk">SNK at GitHub</a> <a href="#fnref:snk" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a> <a href="#fnref:snk:1" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;<sup>2</sup></a></p><li id="fn:crackstation" role="doc-endnote"><p><a href="https://crackstation.net/">Crackstation</a> <a href="#fnref:crackstation" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p><li id="fn:aws-cf" role="doc-endnote"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html">What is AWS CloudFormation</a> <a href="#fnref:aws-cf" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p></ol></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/blog/projects/">Projects</a>, <a href="/blog/ctf/">CTF</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/privesc/" class="post-tag no-text-decoration" >PrivEsc</a> <a href="/tags/lfi/" class="post-tag no-text-decoration" >LFI</a> <a href="/tags/sqli/" class="post-tag no-text-decoration" >SQLi</a> <a href="/tags/aws/" class="post-tag no-text-decoration" >AWS</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=The%20Attack%20Titan%20-%20Ibrahim%20EO.&url=%2Fprojects%2Fattack-titan%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=The%20Attack%20Titan%20-%20Ibrahim%20EO.&u=%2Fprojects%2Fattack-titan%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fprojects%2Fattack-titan%2F&text=The%20Attack%20Titan%20-%20Ibrahim%20EO." target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/k-cessation/">K-Cessation</a><li class="text-truncate lh-lg"> <a href="/posts/race-condition/">Race Conditions Challenge</a><li class="text-truncate lh-lg"> <a href="/projects/attack-titan/">The Attack Titan</a><li class="text-truncate lh-lg"> <a href="/posts/wonderland/">Wonderland</a><li class="text-truncate lh-lg"> <a href="/posts/startup/">Startup</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">Cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/john/">john</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpg/">GPG</a> <a class="post-tag btn btn-outline-primary" href="/tags/lfi/">LFI</a> <a class="post-tag btn btn-outline-primary" href="/tags/wireshark/">Wireshark</a> <a class="post-tag btn btn-outline-primary" href="/tags/apache2/">Apache2</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">AWS</a> <a class="post-tag btn btn-outline-primary" href="/tags/binwalk/">binwalk</a> <a class="post-tag btn btn-outline-primary" href="/tags/borg/">borg</a> <a class="post-tag btn btn-outline-primary" href="/tags/c/">C</a></div></section></div><section id="toc-wrapper" class="d-none ps-0 pe-4"><h2 class="panel-heading ps-3 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/dogcat/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1710889200" data-df="ll" > Mar 20, 2024 </time><h4 class="pt-0 my-2">Dogcat</h4><div class="text-muted"><p>I made a website where you can look at pictures of dogs and/or cats! Exploit a PHP application via LFI and break out of a docker container.</p></div></div></a></article><article class="col"> <a href="/projects/passman/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1708815600" data-df="ll" > Feb 25, 2024 </time><h4 class="pt-0 my-2">PassMan</h4><div class="text-muted"><p>A Simple Password Manager App</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/dogcat/" class="btn btn-outline-primary" aria-label="Older" ><p>Dogcat</p></a> <a href="/posts/wonderland/" class="btn btn-outline-primary" aria-label="Newer" ><p>Wonderland</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2024</time> <a href="https://github.com/elomarii">Ibrahim El Omari</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.0.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">Cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/john/">john</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpg/">GPG</a> <a class="post-tag btn btn-outline-primary" href="/tags/lfi/">LFI</a> <a class="post-tag btn btn-outline-primary" href="/tags/wireshark/">Wireshark</a> <a class="post-tag btn btn-outline-primary" href="/tags/apache2/">Apache2</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">AWS</a> <a class="post-tag btn btn-outline-primary" href="/tags/binwalk/">binwalk</a> <a class="post-tag btn btn-outline-primary" href="/tags/borg/">borg</a> <a class="post-tag btn btn-outline-primary" href="/tags/c/">C</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.11/dayjs.min.js,npm/dayjs@1.11.11/locale/en.min.js,npm/dayjs@1.11.11/plugin/relativeTime.min.js,npm/dayjs@1.11.11/plugin/localizedFormat.min.js,npm/tocbot@4.27.20/dist/tocbot.min.js"></script> <script src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js"></script> <script>SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
