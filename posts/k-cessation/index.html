<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.0" /><meta property="og:title" content="K-Cessation" /><meta name="author" content="Ibrahim" /><meta property="og:locale" content="en" /><meta name="description" content="Breaking an encryption scheme" /><meta property="og:description" content="Breaking an encryption scheme" /><link rel="canonical" href="/posts/k-cessation/" /><meta property="og:url" content="/posts/k-cessation/" /><meta property="og:site_name" content="Ibrahim EO." /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-09-09T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="K-Cessation" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Ibrahim" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ibrahim"},"dateModified":"2024-09-11T20:17:55+02:00","datePublished":"2024-09-09T00:00:00+02:00","description":"Breaking an encryption scheme","headline":"K-Cessation","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/k-cessation/"},"url":"/posts/k-cessation/"}</script><title>K-Cessation | Ibrahim EO.</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ibrahim EO."><meta name="application-name" content="Ibrahim EO."><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/elomarii-portfolio.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.27.20/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-X4YT79QSQC"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-X4YT79QSQC'); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/avatar.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/whoami">Ibrahim EO.</a></h1><p class="site-subtitle fst-italic mb-0">Information Systems Engineer / InfoSec Enthousiaste</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-bars-progress"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/blog/" class="nav-link"> <i class="fa-fw fas fa-newspaper"></i> <span>BLOG</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/whoami/" class="nav-link"> <i class="fa-fw fas fa-chess-rook"></i> <span>WHOAMI</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/elomarii" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/ibrahim-el-omari/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['i.ibrahim.elomari','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>K-Cessation</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>K-Cessation</h1><p class="post-desc fw-light mb-4">Breaking an encryption scheme</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1725832800" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 9, 2024 </time> </span><div class="d-flex justify-content-between"> <span> By <em> Ibrahim </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1123 words" > <em>6 min</em> read</span></div></div></div></header><div class="content"><h2 id="a-the-algorithm"><span class="me-2">A. The algorithm</span><a href="#a-the-algorithm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>K-Cessation cipher is a cipher that uses a K-bits wheel to pick the next cipher bit matching the plaintext bit. When encryption starts, the wheel starts at the last bit of the wheel and loops around when it reaches the end.</p><p>For every plaintext bit, the wheel is rotated to the next bit in the wheel that matches the plaintext bit, and the distance rotated is appended to the ciphertext. Therefore, if the wheel is not known, it is not possible to decrypt the ciphertext. Or is it?</p><h4 id="example"><span class="me-2"><strong>Example</strong></span><a href="#example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>To encode “youtu.be/dQw4w9WgXcQ” in 64-Cessation with the wheel 1100011011100011100110100011110110010110010100001011111011111010:</p><ol><li>Convert the plaintext to bits: 01111001 01101111 01110101 01110100 01110101 00101110 01100010 01100101 00101111 01100100 01010001 01110111 00110100 01110111 00111001 01010111 01100111 01011000 01100011 01010001<li>First bit is “0”, the distance from wheel[-1] to the next “0” bit in the wheel is 3, the ciphertext is 3 and the current wheel position moves to wheel[2]<li>Next bit is “1”, the distance from wheel[2] to the next “1” bit in the wheel is 3, the ciphertext is 3 and the current wheel position moves to wheel[5]<li>Repeat the steps until all bits is encoded<li>the result is 3312121232111411211311221152515233123332223411313221112161142123243321244111111311111112111131113211132412111212112112321122115251142114213312132313311222111112</ol><h2 id="b-the-challenge"><span class="me-2">B. The challenge</span><a href="#b-the-challenge" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>A flag is encoded with 64-Cessation cipher. The ciphertext is given and the wheel is not known. The flag is only known to be an ascii string that is longer than 64 characters.</p><p>No part of the flag is known, which means the flag is NOT in WMCTF{} or FLAG{} format. The most significant bit of each byte is flipped with a random bit.</p><p>You need to extract the flag from the ciphertext and submit it. For your convenience, a salted sha256 hash of the flag is given in flag_hash.txt.</p><h3 id="brainstorming"><span class="me-2">Brainstorming</span><a href="#brainstorming" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>With only the ciphertext at hand, we can extract some juicy information about the similarity of the wheel’s bits:</p><ol><li><p><strong>Similar bits.</strong> For each ciphertext entry that is greater than or equal to 3, we can identify at least two similar bits of the key. In fact, the current wheel position will keep moving forward until the bit matching the plaintext bit is found, which implies that all the bits visited before are of the opposite value.</p><li><p><strong>Different bits.</strong> Similar to the previous reasoning, for each cipher text greater than or equal to 2, we can conclude that the current wheel position and the previous one are two bits of different value.</p></ol><h3 id="solution"><span class="me-2">Solution</span><a href="#solution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The information leaked about the key can help in reducing the set of possible keys, which makes it easier for us to brute force the flag value.</p><p>The solution we propose in the following script does exactly that: We first identify similarities of the key’s bits, then we construct a set of all valid keys according to the previous conditions, and finally we decrypt the ciphertext and check the correctness of the result flag by comparing its hash to the given one.</p><div file="get_flag.py" class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="get_flag.py"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">hashlib</span>

<span class="c1"># given challenge file
</span><span class="kn">import</span> <span class="n">chal</span>

<span class="c1"># given ciphertext, wheel's length, and the flag hash
</span><span class="n">ct</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">...</span><span class="n">SNIP</span><span class="p">...,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">HASH</span> <span class="o">=</span> <span class="sh">"</span><span class="s">d650078ae91d82ebd1d586110960a789c1a15e2cbc053b9daf8d8a4905950720</span><span class="sh">"</span>
<span class="n">SALT</span> <span class="o">=</span> <span class="sh">"</span><span class="s">b840089ce93581869e9c02a7b5aefa7b</span><span class="sh">"</span>
<span class="n">LEN</span> <span class="o">=</span> <span class="mi">64</span>

<span class="k">def</span> <span class="nf">identify_similarity</span><span class="p">(</span><span class="n">ctext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
    <span class="sh">"""</span><span class="s">idenfy similar and different bits of the wheel</span><span class="sh">"""</span>
    <span class="n">similars</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">differents</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># idetify sets of similar consecutive bits based on the ct
</span>    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ctext</span><span class="p">:</span>
        <span class="n">ptr</span> <span class="o">+=</span> <span class="n">v</span>
        <span class="n">ptr</span> <span class="o">%=</span> <span class="n">LEN</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">similar</span> <span class="o">=</span> <span class="p">{(</span><span class="n">ptr</span><span class="o">-</span><span class="n">i</span><span class="p">)</span><span class="o">%</span><span class="n">LEN</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">)}</span>
            <span class="n">differents</span><span class="p">.</span><span class="nf">add</span><span class="p">(((</span><span class="n">ptr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">LEN</span><span class="p">,</span> <span class="n">ptr</span><span class="p">))</span>
            <span class="n">similars</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">similar</span><span class="p">)</span>

    <span class="c1"># remove repetitions
</span>    <span class="n">clean</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">similars</span><span class="p">:</span>
        <span class="n">intersected</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">clean</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">intersection</span><span class="p">(</span><span class="n">clean</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">intersected</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">clean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">|</span> <span class="n">s</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">intersected</span><span class="p">:</span>
            <span class="n">clean</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    
    <span class="c1"># order lists
</span>    <span class="n">ordered</span> <span class="o">=</span> <span class="p">[</span><span class="nf">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">clean</span><span class="p">]</span>
    <span class="n">ordered</span><span class="p">.</span><span class="nf">sort</span><span class="p">()</span>
    <span class="n">differents</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">differents</span><span class="p">)</span>
    <span class="n">differents</span><span class="p">.</span><span class="nf">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ordered</span><span class="p">,</span> <span class="n">differents</span>

<span class="k">def</span> <span class="nf">get_sim_indexes</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">for given index of the wheel, return range of similar bits</span><span class="sh">"""</span>
    <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">sim</span><span class="p">:</span>
        <span class="n">li</span><span class="p">.</span><span class="nf">sort</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">li</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">li</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">li</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">idx</span><span class="p">,</span> <span class="n">idx</span>

<span class="n">potential_wheels</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">fill_wheel</span><span class="p">(</span><span class="n">wheel</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">sim</span><span class="p">,</span> <span class="n">diff</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    construct potential wheels, the initial wheel contains only asteriscs
    wheel = [</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="s">, ..., </span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="s">]
    </span><span class="sh">"""</span>
    <span class="k">if</span> <span class="n">wheel</span><span class="p">.</span><span class="nf">count</span><span class="p">(</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># a whell is constructed, add it to the list
</span>        <span class="n">potential_wheels</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">wheel</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># construct one
</span>        <span class="n">curr_idx</span> <span class="o">=</span> <span class="n">wheel</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wheel</span><span class="p">[</span><span class="n">curr_idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nf">get_sim_indexes</span><span class="p">((</span><span class="n">curr_idx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">LEN</span><span class="p">,</span> <span class="n">sim</span><span class="p">)</span>
            <span class="n">w1</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">wheel</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="n">w1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span>
            <span class="nf">fill_wheel</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
            <span class="n">w2</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">wheel</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="n">w2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">1</span><span class="sh">"</span>
            <span class="nf">fill_wheel</span><span class="p">(</span><span class="n">w2</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
        <span class="nf">elif </span><span class="p">((</span><span class="n">curr_idx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">LEN</span><span class="p">,</span> <span class="n">curr_idx</span><span class="p">)</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nf">get_sim_indexes</span><span class="p">(</span><span class="n">curr_idx</span><span class="p">,</span> <span class="n">sim</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">wheel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">1</span><span class="sh">"</span> <span class="k">if</span> <span class="n">wheel</span><span class="p">[</span><span class="n">curr_idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span> <span class="k">else</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span>
            <span class="nf">fill_wheel</span><span class="p">(</span><span class="n">wheel</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nf">get_sim_indexes</span><span class="p">(</span><span class="n">curr_idx</span><span class="p">,</span> <span class="n">sim</span><span class="p">)</span>
            <span class="n">w1</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">wheel</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="n">w1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span>
            <span class="nf">fill_wheel</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
            <span class="n">w2</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">wheel</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="n">w2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">1</span><span class="sh">"</span>
            <span class="nf">fill_wheel</span><span class="p">(</span><span class="n">w2</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">filter_wheels</span><span class="p">(</span><span class="n">wheels</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">validate given wheels according to similarity extracted from ciphertext</span><span class="sh">"""</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">wheel</span> <span class="ow">in</span> <span class="n">wheels</span><span class="p">:</span>
        <span class="n">good</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">bits</span> <span class="ow">in</span> <span class="n">sim</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">wheel</span><span class="p">[</span><span class="n">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nf">all</span><span class="p">((</span><span class="n">wheel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bits</span><span class="p">)):</span> <span class="n">good</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">bits</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">wheel</span><span class="p">[</span><span class="n">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">wheel</span><span class="p">[</span><span class="n">bits</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span> <span class="n">good</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">good</span><span class="p">:</span> <span class="n">valid</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">wheel</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">valid</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="c1"># construct potential wheels
</span>    <span class="n">similars</span><span class="p">,</span> <span class="n">differents</span> <span class="o">=</span> <span class="nf">identify_similarity</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
    <span class="nf">fill_wheel</span><span class="p">([</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">LEN</span><span class="p">)],</span> <span class="n">similars</span><span class="p">,</span> <span class="n">differents</span><span class="p">)</span>
    <span class="n">potential_wheels</span> <span class="o">=</span> <span class="nf">filter_wheels</span><span class="p">(</span><span class="n">potential_wheels</span><span class="p">,</span> <span class="n">similars</span><span class="p">,</span> <span class="n">differents</span><span class="p">)</span>
    <span class="c1"># convert content to integers
</span>    <span class="n">wheels</span> <span class="o">=</span> <span class="p">[[</span><span class="nf">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">st</span><span class="p">]</span> <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">potential_wheels</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">wheel</span> <span class="ow">in</span> <span class="n">wheels</span><span class="p">:</span>
        <span class="c1"># check if the wheel is the one used in encryption
</span>        <span class="c1"># validate so by comparing the hash of the found plaintext with the given hash
</span>        <span class="n">cipher</span> <span class="o">=</span> <span class="n">chal</span><span class="p">.</span><span class="nc">K_Cessation</span><span class="p">([</span><span class="nf">int</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">wheel</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="n">cipher</span><span class="p">.</span><span class="nf">decrypt</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="n">chal</span><span class="p">.</span><span class="nf">decode_ascii_with_random_msb</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hashlib</span><span class="p">.</span><span class="nf">sha256</span><span class="p">((</span><span class="n">SALT</span> <span class="o">+</span> <span class="n">pt</span><span class="p">.</span><span class="nf">decode</span><span class="p">()).</span><span class="nf">encode</span><span class="p">()).</span><span class="nf">hexdigest</span><span class="p">()</span> <span class="o">==</span> <span class="n">HASH</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">continue</span>
</pre></table></code></div></div><blockquote class="prompt-warning"><p>The code maybe optimized in length and performance.</p></blockquote><p><strong>Result</strong>: <kbd>DoubleUmCtF[S33K1NG_tru7h-7h3_w1s3-f1nd_1n57e4d-17s_pr0f0und-4b5ence_n0w-g0_s0lv3-th3_3y3s-1n_N0ita]</kbd></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/blog/ctf-writeups/">CTF Writeups</a>, <a href="/blog/wmctf-2024/">WMCTF 2024</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/cryptography/" class="post-tag no-text-decoration" >Cryptography</a> <a href="/tags/k-cessation/" class="post-tag no-text-decoration" >K-Cessation</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=K-Cessation%20-%20Ibrahim%20EO.&url=%2Fposts%2Fk-cessation%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=K-Cessation%20-%20Ibrahim%20EO.&u=%2Fposts%2Fk-cessation%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fk-cessation%2F&text=K-Cessation%20-%20Ibrahim%20EO." target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/projects/borderland/">Borderland</a><li class="text-truncate lh-lg"> <a href="/projects/chirpy-react/">Chirpy React</a><li class="text-truncate lh-lg"> <a href="/projects/attack-titan/">Shingeki</a><li class="text-truncate lh-lg"> <a href="/projects/passman/">PassMan</a><li class="text-truncate lh-lg"> <a href="/posts/hammer/">Hammer</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/dfir/">DFIR</a> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">Cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/john/">john</a> <a class="post-tag btn btn-outline-primary" href="/tags/phishing/">Phishing</a> <a class="post-tag btn btn-outline-primary" href="/tags/wireshark/">Wireshark</a> <a class="post-tag btn btn-outline-primary" href="/tags/elk/">ELK</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpg/">GPG</a> <a class="post-tag btn btn-outline-primary" href="/tags/kibana/">Kibana</a> <a class="post-tag btn btn-outline-primary" href="/tags/active-directory/">Active Directory</a> <a class="post-tag btn btn-outline-primary" href="/tags/apache2/">Apache2</a></div></section></div><section id="toc-wrapper" class="d-none ps-0 pe-4"><h2 class="panel-heading ps-3 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/projects/passman/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1708815600" data-df="ll" > Feb 25, 2024 </time><h4 class="pt-0 my-2">PassMan</h4><div class="text-muted"><p>A Simple Password Manager App</p></div></div></a></article><article class="col"> <a href="/posts/power-analysis-warmup/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1708556400" data-df="ll" > Feb 22, 2024 </time><h4 class="pt-0 my-2">PowerAnalysis - Warmup</h4><div class="text-muted"><p>Analyse encryption algorithm to break it</p></div></div></a></article><article class="col"> <a href="/posts/overpass-2-hacked/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1710198000" data-df="ll" > Mar 12, 2024 </time><h4 class="pt-0 my-2">Overpass 2 Hacked</h4><div class="text-muted"><p>Overpass has been hacked! The SOC team (Paradox, congratulations on the promotion) noticed suspicious activity on a late night shift while looking at shibes, and managed to capture packets as the a...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/race-condition/" class="btn btn-outline-primary" aria-label="Older" ><p>Race Conditions Challenge</p></a> <a href="/posts/itsy-bitsy/" class="btn btn-outline-primary" aria-label="Newer" ><p>ItsyBitsy</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://github.com/elomarii">Ibrahim El Omari</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >All rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.0.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/dfir/">DFIR</a> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">Cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/john/">john</a> <a class="post-tag btn btn-outline-primary" href="/tags/phishing/">Phishing</a> <a class="post-tag btn btn-outline-primary" href="/tags/wireshark/">Wireshark</a> <a class="post-tag btn btn-outline-primary" href="/tags/elk/">ELK</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpg/">GPG</a> <a class="post-tag btn btn-outline-primary" href="/tags/kibana/">Kibana</a> <a class="post-tag btn btn-outline-primary" href="/tags/active-directory/">Active Directory</a> <a class="post-tag btn btn-outline-primary" href="/tags/apache2/">Apache2</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.11/dayjs.min.js,npm/dayjs@1.11.11/locale/en.min.js,npm/dayjs@1.11.11/plugin/relativeTime.min.js,npm/dayjs@1.11.11/plugin/localizedFormat.min.js,npm/tocbot@4.27.20/dist/tocbot.min.js"></script> <script src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js"></script> <script>SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
